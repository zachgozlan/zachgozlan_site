<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Projects – Zach Gozlan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Zach Gozlan</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../projects"> 
<span class="menu-text">Data Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../lists_of_stuff"> 
<span class="menu-text">Lists of Stuff</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../other_media"> 
<span class="menu-text">Guest Appearances</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#trivia-projects" id="toc-trivia-projects" class="nav-link active" data-scroll-target="#trivia-projects">Trivia Projects</a>
  <ul class="collapse">
  <li><a href="#studying-for-jeopardy" id="toc-studying-for-jeopardy" class="nav-link" data-scroll-target="#studying-for-jeopardy">Studying for Jeopardy</a></li>
  <li><a href="#learnedleague-season-simulator" id="toc-learnedleague-season-simulator" class="nav-link" data-scroll-target="#learnedleague-season-simulator">LearnedLeague Season Simulator</a></li>
  </ul></li>
  <li><a href="#professional-wrestling-projects" id="toc-professional-wrestling-projects" class="nav-link" data-scroll-target="#professional-wrestling-projects">Professional Wrestling Projects</a>
  <ul class="collapse">
  <li><a href="#aew-wrestler-trueskill-dashboard-project" id="toc-aew-wrestler-trueskill-dashboard-project" class="nav-link" data-scroll-target="#aew-wrestler-trueskill-dashboard-project">AEW Wrestler TrueSkill Dashboard Project</a></li>
  <li><a href="#nxt-takeover-wrestler-network" id="toc-nxt-takeover-wrestler-network" class="nav-link" data-scroll-target="#nxt-takeover-wrestler-network">NXT TakeOver Wrestler Network</a></li>
  </ul></li>
  <li><a href="#fantasy-sports-projects" id="toc-fantasy-sports-projects" class="nav-link" data-scroll-target="#fantasy-sports-projects">Fantasy Sports Projects</a>
  <ul class="collapse">
  <li><a href="#calcutta-auction-flask-application" id="toc-calcutta-auction-flask-application" class="nav-link" data-scroll-target="#calcutta-auction-flask-application">Calcutta Auction Flask Application</a></li>
  <li><a href="#fantasy-league-monte-carlo-simulation" id="toc-fantasy-league-monte-carlo-simulation" class="nav-link" data-scroll-target="#fantasy-league-monte-carlo-simulation">Fantasy League Monte Carlo Simulation</a></li>
  </ul></li>
  <li><a href="#wedding-presents" id="toc-wedding-presents" class="nav-link" data-scroll-target="#wedding-presents">Wedding Presents</a></li>
  <li><a href="#academic-projects" id="toc-academic-projects" class="nav-link" data-scroll-target="#academic-projects">Academic Projects</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Projects</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>With one exception at the bottom of the page, these are all projects I have done in my free time because I was interested in the topic at hand, with the nice bonus of having something to show for it at the end that’s relevant to my professional skill set.</p>
<section id="trivia-projects" class="level2">
<h2 class="anchored" data-anchor-id="trivia-projects">Trivia Projects</h2>
<section id="studying-for-jeopardy" class="level3">
<h3 class="anchored" data-anchor-id="studying-for-jeopardy">Studying for Jeopardy</h3>
<div class="quarto-figure quarto-figure-center" style="border: 1px solid black;">
<figure class="figure">
<p><img src="images/clipboard-2202959785.png" class="picture_border img-fluid figure-img"></p>
<figcaption>My progress studying for Jeopardy, July - November 2021.</figcaption>
</figure>
</div>
<p>I <a href="https://j-archive.com/showplayer.php?player_id=14435">appeared on Jeopardy!</a> in early 2022 after years of taking the qualification test, fulfilling a lifelong dream. In the months prior to my appearance, I used study methods developed by previous contestants to build a data project out of studying for the show. This included identifying the patterns seen on Jeopardy! game boards to determine the most important subjects for me to study, as well as using text analysis methods to quickly identify the most important facts to know <em>about</em> a given topic.</p>
<ul>
<li><p>An article I wrote about the project, including methods and outcomes, is available <a href="https://zachgozlan.github.io/jeopardy-prep-work/">here</a>.</p></li>
<li><p>A presentation I gave at my office’s internal “Data Day” is also available for viewing <a href="https://www.youtube.com/watch?v=ZU0hV2y5z_I">here</a>. I am aware that I should have used the provided microphone.</p></li>
<li><p>My git repo for this project is available <a href="https://github.com/zachgozlan/jeopardy-prep-work">here</a>.</p></li>
</ul>
<p>While I did not win on the episode of Jeopardy! discussed in the project, I did nonetheless get to return two years later to compete on <a href="https://popculturejeopardy.com/">Pop Culture Jeopardy!</a> - which is currently available for streaming on Prime Video - and that <a href="https://www.youtube.com/watch?v=7_VUKyKGzag">went better for me.</a></p>
</section>
<section id="learnedleague-season-simulator" class="level3">
<h3 class="anchored" data-anchor-id="learnedleague-season-simulator">LearnedLeague Season Simulator</h3>
<p><a href="https://learnedleague.com/">LearnedLeague</a> is an online trivia competition that dorks like me do for daily hits of validation. After previously writing a less complicated script to predict fantasy sports match-ups (discussed below), I expanded that code to create a Monte Carlo simulation of LearnedLeague seasons.</p>
<p>To view the git repo for this project, click <a href="https://github.com/zachgozlan/LearnedLeague-Season-Sim">here.</a></p>
</section>
</section>
<section id="professional-wrestling-projects" class="level2">
<h2 class="anchored" data-anchor-id="professional-wrestling-projects">Professional Wrestling Projects</h2>
<p>I am probably one of very few practitioners in the field of professional wrestling data analysis. That may be because that is a field with absolutely no potential value to anyone above it being kind of interesting to a small number of people. But that also means I might be the <em>best</em> at it. Think about that.</p>
<section id="aew-wrestler-trueskill-dashboard-project" class="level3">
<h3 class="anchored" data-anchor-id="aew-wrestler-trueskill-dashboard-project">AEW Wrestler TrueSkill Dashboard Project</h3>
<p>During the first few years of its existence, professional wrestling promotion All Elite Wrestling (AEW) published a ranking system within the fiction of professional wrestling to select top contenders for its various titles. As a personal challenge, I devoted several weeks in 2021 to creating an objective alternative to this ranking. This ultimately produced a ranking based in the <a href="https://trueskill.org/">TrueSkill package</a> and a Tableau dashboard that allowed users to see the rankings on any given day since the company’s start in 2019.</p>
<ul>
<li><p>The final dashboard product is available on Tableau Public <a href="https://public.tableau.com/app/profile/zach.gozlan/viz/AEWTrueskillDashes/Dashboard1">here</a>. It is no longer being updated as of January 2024.</p></li>
<li><p>A somewhat longer narrative write-up of this project is available <a href="https://rpubs.com/zachgozlan/aew_skill">here.</a></p></li>
<li><p>After I realized the ratings provided by the model had some amount of predictive ability, I wrote about that in the context of a particularly lopsided match in a Reddit post available <a href="https://www.reddit.com/r/SquaredCircle/comments/p3fs68/based_on_a_statistical_model_of_the_history_of/">here.</a> The post was later nominated for best submission of the year by the community, receiving 8% of the vote and finishing in sixth.</p></li>
<li><p>The full git repo is available <a href="https://github.com/zachgozlan/aew_skilldash">here.</a></p></li>
</ul>
</section>
<section id="nxt-takeover-wrestler-network" class="level3">
<h3 class="anchored" data-anchor-id="nxt-takeover-wrestler-network">NXT TakeOver Wrestler Network</h3>
<p>As practice in the field of network analysis, I pulled the complete set of matches that happened at <a href="https://en.wikipedia.org/wiki/NXT_TakeOver">NXT TakeOver</a> events and created a network of all wrestlers who have either competed against one another or teamed together, as well as running some basic centrality measures on that network. The git repo for that project is available <a href="https://github.com/zachgozlan/prowrestling_network_map">here.</a></p>
</section>
</section>
<section id="fantasy-sports-projects" class="level2">
<h2 class="anchored" data-anchor-id="fantasy-sports-projects">Fantasy Sports Projects</h2>
<p>Yes! I am a boy.</p>
<section id="calcutta-auction-flask-application" class="level3">
<h3 class="anchored" data-anchor-id="calcutta-auction-flask-application">Calcutta Auction Flask Application</h3>
<p>After running a <a href="https://en.wikipedia.org/wiki/Calcutta_auction">Calcutta auction</a> via a hastily managed Google form during the 2022 World Cup, I had a “there’s got to be a better way!” moment and spent the next few months on and off looking into means by which I could automate the process. This led to me building a Flask application on the <a href="https://www.pythonanywhere.com/">Python Anywhere</a> platform, which I used to run a Calcutta auction for the 2023 March Madness tournament. The final product ran relatively slowly, but as a first effort I am proud of it. I lost money on this endeavor, which is probably for the best.</p>
<ul>
<li><p>The app itself, which is probably still live as you reading this, is available <a href="https://zachgozlan.pythonanywhere.com/rules">here.</a></p></li>
<li><p>The (incomplete) git repo for the project is available <a href="https://github.com/zachgozlan/calcutta_flask/tree/main">here.</a></p></li>
</ul>
</section>
<section id="fantasy-league-monte-carlo-simulation" class="level3">
<h3 class="anchored" data-anchor-id="fantasy-league-monte-carlo-simulation">Fantasy League Monte Carlo Simulation</h3>
<p>This is the original attempt at writing a script that simulates a series of head-to-head matchups, factoring in previous records and tiebreakers to predict a likelihood that any given team finishes in any given place in the standings table. I’ve iterated over it plenty of times as I’ve gotten better at Python and as Yahoo! continuously changes its interface, but the git repo for a reasonably recent version is available <a href="https://github.com/zachgozlan/fantasy_playoff_odds">here.</a></p>
</section>
</section>
<section id="wedding-presents" class="level2">
<h2 class="anchored" data-anchor-id="wedding-presents">Wedding Presents</h2>
<p>Yes! Even wedding presents.</p>
<p>One year into my graduate studies in data science, I was eager to show off my new skills. Conveniently, I was invited to two weddings that summer and decided to make that their problems. Because I had robust Facebook Messenger chat histories with parts of both of the two weddings, I decided it’d be neat to pull down those chat logs and do something with them.</p>
<p>At one wedding, I was the man of honor (although I used “maid of honor” plenty, because that was a fun thing to get to call myself) and as part of that role gave a speech during the reception. In a portion of the speech, I surprised the bride with a series of metrics regarding how many times we had mentioned our respective dogs, a playlist of every YouTube video we had sent each other in the past ten years, and the first times she had mentioned her now husband in our chat, among other milestones. It is worth mentioning that this was not the entire speech, and also that despite the relative simplicity of “download and analyze a json” this is probably the most satisfied I have been with any project I have ever done.</p>
<p>At the other wedding, I was involved in a robust group chat with one of parties getting married; including with an actual gift was a ten-page long “card” detailing various group chat inside jokes and a term-frequency analysis of words that each member used the most since we had started talking.</p>
<p>As you can imagine, both of these end products are personal and won’t be shared. The git repo, of course, is available <a href="https://github.com/zachgozlan/facebook-messenger-json-parsing">here.</a></p>
</section>
<section id="academic-projects" class="level2">
<h2 class="anchored" data-anchor-id="academic-projects">Academic Projects</h2>
<p><img src="images/clipboard-3921772283.png" class="img-fluid"></p>
<p>For a Data Visualization course I took in early 2020 as part of my Master’s coursework, under the instruction of <a href="https://x.com/data4d?lang=en">Taylor Corbett</a>, I created a short discussion of the <a href="https://gss.norc.org/">General Social Survey</a> featuring several interactive visualizations based heavily in <a href="https://plotly.com/r/">plotly</a>. Throughout my time at Georgetown I had been assisting Professor <a href="https://www.jonathanmladd.com/">Jonathan Ladd</a> with research on GSS data as it relates to public confidence, so I came in with significant familiarity with the data and as a result I’m very proud of what I put together.</p>
<p>The project itself is available for viewing <a href="https://zachgozlan.github.io/ppol563_final_project/">here</a> as a Github Page, and the code repo is available <a href="https://github.com/zachgozlan/ppol563_final_project/tree/master?tab=readme-ov-file">here.</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>